openapi: 3.0.3
info:
  title: DB Agent API
  description: |
    A MongoDB database agent API with AI-powered natural language query capabilities.

    This API provides CRUD operations for MongoDB collections and includes an AI agent
    that can execute natural language prompts to query and manipulate data. All data
    endpoints support OData query protocol for filtering, sorting, and pagination.

    The API supports multi-tenancy, allowing multiple isolated database configurations.
    Most endpoints require authentication via the x-tenant-id header.
  version: 1.0.0
  contact:
    name: API Support
servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://your-production-url.com
    description: Production server

tags:
  - name: Health
    description: Health check and status endpoints
  - name: Tenants
    description: Multi-tenant management operations
  - name: Data
    description: MongoDB collection operations with OData support
  - name: Transform
    description: AI-powered JSON transformation
  - name: Events
    description: Event logging and retrieval
  - name: Prompt Logs
    description: AI prompt execution history and logs

security:
  - TenantAuth: []

paths:
  /:
    get:
      tags:
        - Health
      summary: Root health check
      description: Simple health check endpoint that returns a checkmark
      operationId: rootHealthCheck
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            text/html:
              schema:
                type: string
                example: 'âœ…'

  /health:
    get:
      tags:
        - Health
      summary: Detailed health check
      description: Returns detailed health information including status, timestamp, and uptime
      operationId: healthCheck
      security: []
      responses:
        '200':
          description: Health check information
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: 'ok'
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                    description: Server uptime in seconds
              example:
                status: 'ok'
                timestamp: '2025-12-26T10:00:00.000Z'
                uptime: 3600.5

  /tenants:
    get:
      tags:
        - Tenants
      summary: List all tenants
      description: Returns a list of all configured tenants with their database configurations
      operationId: listTenants
      security: []
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  tenants:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tenant'
              example:
                tenants:
                  - id: '507f1f77bcf86cd799439011'
                    dbName: 'my_database'
                    displayConfig:
                      users: ['name', 'email']
                      products: ['name', 'price']
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Tenants
      summary: Create a new tenant
      description: |
        Create a new tenant configuration with database connection details.
        The database connection string will be encrypted before storage.
      operationId: createTenant
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - dbConnectionString
                - dbName
                - displayConfig
              properties:
                dbConnectionString:
                  type: string
                  description: MongoDB connection string (will be encrypted)
                  example: 'mongodb://localhost:27017'
                dbName:
                  type: string
                  description: Name of the database to use
                  example: 'my_database'
                displayConfig:
                  type: object
                  description: Configuration for which fields to display for each collection
                  additionalProperties:
                    type: array
                    items:
                      type: string
                  example:
                    users: ['name', 'email']
                    products: ['name', 'price', 'category']
      responses:
        '200':
          description: Tenant created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  tenant:
                    $ref: '#/components/schemas/Tenant'
              example:
                tenant:
                  id: '507f1f77bcf86cd799439011'
                  dbName: 'my_database'
                  displayConfig:
                    users: ['name', 'email']
                    products: ['name', 'price', 'category']
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/databases:
    get:
      tags:
        - Data
      summary: List all databases
      description: Returns a list of all available databases for the current tenant
      operationId: listDatabases
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  databases:
                    type: array
                    items:
                      type: string
                    example: ['admin', 'local', 'my_database']
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/collections:
    get:
      tags:
        - Data
      summary: List all collections
      description: Returns a list of all available MongoDB collections in the database
      operationId: listCollections
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  collections:
                    type: array
                    items:
                      type: string
                    example: ['users', 'products', 'orders']
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/queries:
    post:
      tags:
        - Data
      summary: Execute multiple database queries
      description: |
        Execute an array of raw MongoDB queries and return their results.
        This endpoint allows you to run multiple queries in parallel and get back
        the serialized results. Queries must be valid MongoDB query strings.
        Requires a promptLogId to associate the queries with a prompt execution.
      operationId: executeQueries
      parameters:
        - name: promptLogId
          in: query
          required: true
          description: ID of the prompt log to associate these queries with
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
      requestBody:
        required: true
        description: Array of MongoDB query strings to execute
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
            examples:
              singleQuery:
                summary: Single query
                value: ["db.users.find({status: 'active'}).toArray()"]
              multipleQueries:
                summary: Multiple queries
                value:
                  - "db.users.findOne({_id: ObjectId('507f1f77bcf86cd799439011')})"
                  - "db.orders.find({userId: ObjectId('507f1f77bcf86cd799439011')}).toArray()"
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                type: array
                items:
                  type: array
                  items:
                    type: object
                    additionalProperties: true
              example:
                - [
                    {
                      '_id': '507f1f77bcf86cd799439011',
                      'name': 'John Doe',
                      'status': 'active',
                    },
                  ]
                - [
                    {
                      '_id': '507f1f77bcf86cd799439012',
                      'orderId': 'ORD-123',
                      'total': 99.99,
                    },
                  ]
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/{collection}:
    get:
      tags:
        - Data
      summary: Get documents from collection
      description: |
        Fetch documents from a specific collection with OData query support.

        Supports OData query parameters:
        - $filter: Filter results using OData filter expressions
        - $select: Select specific fields to return
        - $orderby: Sort results by field(s)
        - $top: Limit number of results
        - $skip: Skip number of results
      operationId: getDocuments
      parameters:
        - $ref: '#/components/parameters/CollectionName'
        - name: $filter
          in: query
          description: OData filter expression (e.g., "status eq 'active'")
          schema:
            type: string
          examples:
            simple:
              value: "status eq 'active'"
              summary: Simple filter
            and:
              value: "status eq 'active' and age gt 18"
              summary: Multiple conditions with AND
            or:
              value: "status eq 'active' or status eq 'pending'"
              summary: Multiple conditions with OR
        - name: $select
          in: query
          description: Comma-separated list of fields to return
          schema:
            type: string
          example: 'name,email,status'
        - name: $orderby
          in: query
          description: Field(s) to sort by with optional direction (asc/desc)
          schema:
            type: string
          example: 'createdAt desc'
        - name: $top
          in: query
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 10
        - name: $skip
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  query:
                    type: object
                    properties:
                      filters:
                        type: object
                        additionalProperties: true
                      projection:
                        type: object
                        additionalProperties: true
                      skip:
                        type: integer
                      limit:
                        type: integer
              example:
                data:
                  - _id: '507f1f77bcf86cd799439011'
                    name: 'John Doe'
                    status: 'active'
                query:
                  filters: {}
                  projection: {}
                  skip: 0
                  limit: 20
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/{collection}/count:
    get:
      tags:
        - Data
      summary: Get document count
      description: |
        Get the total count of documents in a collection, with optional OData filters.
        Supports the $filter OData query parameter for conditional counting.
      operationId: getDocumentCount
      parameters:
        - $ref: '#/components/parameters/CollectionName'
        - name: $filter
          in: query
          description: OData filter expression
          schema:
            type: string
          examples:
            simple:
              value: "status eq 'active'"
              summary: Count active documents
            complex:
              value: "status eq 'active' and age gt 18"
              summary: Count with multiple conditions
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: Number of documents matching the criteria
                example:
                  count: 42
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/{collection}/{id}:
    get:
      tags:
        - Data
      summary: Get document by ID
      description: Retrieve a specific document by its MongoDB ObjectId
      operationId: getDocumentById
      parameters:
        - $ref: '#/components/parameters/CollectionName'
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              example:
                _id: '507f1f77bcf86cd799439011'
                name: 'John Doe'
                email: 'john@example.com'
                status: 'active'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Data
      summary: Update document by ID
      description: |
        Update fields in a specific document. Only the fields provided in the
        request body will be updated. This operation creates an UPDATE event log entry.
      operationId: updateDocumentById
      parameters:
        - $ref: '#/components/parameters/CollectionName'
        - $ref: '#/components/parameters/DocumentId'
      requestBody:
        required: true
        description: Fields to update
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
            examples:
              singleField:
                summary: Update single field
                value:
                  lastLogin: '2025-12-22T10:30:00Z'
              multipleFields:
                summary: Update multiple fields
                value:
                  name: 'Jane Doe'
                  status: 'inactive'
      responses:
        '200':
          description: Document updated successfully
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
              example:
                _id: '507f1f77bcf86cd799439011'
                name: 'Jane Doe'
                email: 'john@example.com'
                status: 'inactive'
                lastLogin: '2025-12-22T10:30:00Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Data
      summary: Delete document by ID
      description: |
        Delete a specific document from a collection.
        This operation creates a DELETE event log entry.
      operationId: deleteDocumentById
      parameters:
        - $ref: '#/components/parameters/CollectionName'
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: Document deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  deletedCount:
                    type: integer
                example:
                  success: true
                  deletedCount: 1
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /events:
    get:
      tags:
        - Events
      summary: List all events
      description: |
        Get logged events (UPDATE, DELETE, PROMPT operations) with pagination.
        By default, returns only the events array. Use the debug parameter to
        include pagination metadata and full debug information.
      operationId: listEvents
      parameters:
        - name: skip
          in: query
          description: Number of events to skip
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          description: Maximum number of events to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: debug
          in: query
          description: Include pagination metadata and debug information
          schema:
            type: boolean
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: '#/components/schemas/Event'
                    description: Events array (when debug is not set)
                  - type: object
                    description: Events with pagination (when debug is set)
                    properties:
                      events:
                        type: array
                        items:
                          $ref: '#/components/schemas/Event'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
              examples:
                withoutDebug:
                  summary: Without debug (default)
                  value:
                    - _id: '507f1f77bcf86cd799439012'
                      type: 'UPDATE'
                      collection: 'users'
                      id: '507f1f77bcf86cd799439011'
                      timestamp: '2025-12-22T10:30:00Z'
                      data:
                        name: 'Jane Doe'
                    - _id: '507f1f77bcf86cd799439013'
                      type: 'DELETE'
                      collection: 'users'
                      id: '507f1f77bcf86cd799439014'
                      timestamp: '2025-12-22T10:35:00Z'
                    - _id: '507f1f77bcf86cd799439016'
                      type: 'QUERY'
                      timestamp: '2025-12-22T10:40:00Z'
                      queries:
                        - "db.users.find({status: 'active'}).toArray()"
                      results: [42]
                withDebug:
                  summary: With debug parameter
                  value:
                    events:
                      - _id: '507f1f77bcf86cd799439015'
                        type: 'QUERY'
                        timestamp: '2025-12-22T10:40:00Z'
                        queries:
                          - "db.users.find({status: 'active'}).toArray()"
                        results: [42]
                    pagination:
                      skip: 0
                      limit: 10
                      total: 1
                      hasMore: false
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /events/{id}:
    delete:
      tags:
        - Events
      summary: Delete event by ID
      description: Delete a specific event log entry
      operationId: deleteEventById
      parameters:
        - name: id
          in: path
          required: true
          description: Event ID (MongoDB ObjectId)
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
      responses:
        '200':
          description: Event deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                example:
                  success: true
                  message: 'Event deleted successfully'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: 'Event not found'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /prompt:
    get:
      tags:
        - Prompt Logs
      summary: Execute AI agent prompt
      description: |
        Execute a natural language query or operation using the AI agent.
        This endpoint streams real-time updates using Server-Sent Events (SSE).

        The AI agent can understand and execute complex database operations,
        aggregations, and queries expressed in natural language.
      operationId: executePromptLog
      parameters:
        - name: prompt
          in: query
          required: true
          description: Natural language prompt for the AI agent
          schema:
            type: string
          examples:
            countUsers:
              value: 'How many users are there?'
              summary: Count documents
            recentOrders:
              value: 'Show me all orders from the last 30 days'
              summary: Date-based query
            aggregation:
              value: 'What is the average order value by customer?'
              summary: Aggregation query
      responses:
        '200':
          description: Server-Sent Events stream
          content:
            text/event-stream:
              schema:
                type: string
                description: |
                  SSE stream with events:
                  - 'update': Progress updates with step and content
                  - 'complete': Final result
                  - 'error': Error information
              examples:
                update:
                  value: |
                    event: update
                    data: {"step":"thinking","content":"I need to query the users collection..."}
                complete:
                  value: |
                    event: complete
                    data: {"id":"507f1f77bcf86cd799439015","result":"Found 42 active users","queries":["db.users.find({status: 'active'}).toArray()"]}
                error:
                  value: |
                    event: error
                    data: {"error":"Error message here"}
        '400':
          $ref: '#/components/responses/BadRequest'

  /prompt/log:
    get:
      tags:
        - Prompt Logs
      summary: List all prompt logs
      description: |
        Get a list of all AI prompt execution logs with pagination.
        Each log contains the prompt, result, queries executed, and optional debug information.
      operationId: listPromptLogs
      parameters:
        - name: skip
          in: query
          description: Number of logs to skip
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          description: Maximum number of logs to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PromptLog'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              example:
                data:
                  - _id: '507f1f77bcf86cd799439015'
                    prompt: 'Find all active users'
                    result: 'Found 42 active users'
                    queries: ["db.users.find({status: 'active'}).toArray()"]
                    timestamp: '2025-12-25T10:00:00Z'
                    lastUsedAt: '2025-12-25T10:00:00Z'
                pagination:
                  skip: 0
                  limit: 10
                  total: 25
                  hasMore: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /prompt/log/{id}:
    get:
      tags:
        - Prompt Logs
      summary: Get prompt log by ID
      description: |
        Retrieve a specific prompt log by its ID.
        Use the debug query parameter to include detailed execution trace.
      operationId: getPromptLogById
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt log ID (MongoDB ObjectId)
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
        - name: debug
          in: query
          description: Include debug trace information
          schema:
            type: boolean
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptLog'
              examples:
                withoutDebug:
                  summary: Without debug info
                  value:
                    _id: '507f1f77bcf86cd799439015'
                    prompt: 'Find all active users'
                    result: 'Found 42 active users'
                    queries: ["db.users.find({status: 'active'}).toArray()"]
                    timestamp: '2025-12-25T10:00:00Z'
                    lastUsedAt: '2025-12-25T10:00:00Z'
                withDebug:
                  summary: With debug info
                  value:
                    _id: '507f1f77bcf86cd799439015'
                    prompt: 'Find all active users'
                    result: 'Found 42 active users'
                    queries: ["db.users.find({status: 'active'}).toArray()"]
                    timestamp: '2025-12-25T10:00:00Z'
                    lastUsedAt: '2025-12-25T10:00:00Z'
                    debug:
                      messages:
                        - index: 1
                          step: 'thinking'
                          content: 'I need to query the users collection...'
                        - index: 2
                          step: 'runQuery (tool)'
                          content: "db.users.find({status: 'active'}).toArray()"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Prompt log not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: 'Prompt log not found'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Prompt Logs
      summary: Delete prompt log by ID
      description: Delete a specific prompt log entry
      operationId: deletePromptLogById
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt log ID (MongoDB ObjectId)
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
      responses:
        '200':
          description: Prompt log deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              example:
                success: true
                message: 'Prompt log deleted successfully'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Prompt log not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: 'Prompt log not found'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /transform:
    post:
      tags:
        - Transform
      summary: Transform JSON using AI
      description: |
        Transform JSON data using AI-powered natural language instructions.
        Provide JSON data and a prompt describing how you want to transform it,
        and the AI will return the transformed result.
      operationId: transformJson
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - json
                - prompt
              properties:
                json:
                  type: object
                  additionalProperties: true
                  description: The JSON data to transform
                prompt:
                  type: string
                  description: Natural language instruction for how to transform the data
            examples:
              extractFields:
                summary: Extract specific fields
                value:
                  json:
                    users:
                      - name: 'John Doe'
                        email: 'john@example.com'
                        age: 30
                        city: 'New York'
                      - name: 'Jane Smith'
                        email: 'jane@example.com'
                        age: 25
                        city: 'Los Angeles'
                  prompt: 'Extract only name and email fields from each user'
              restructure:
                summary: Restructure data
                value:
                  json:
                    items:
                      - id: 1
                        name: 'Product A'
                        price: 19.99
                      - id: 2
                        name: 'Product B'
                        price: 29.99
                  prompt: 'Convert to an object keyed by product ID'
      responses:
        '200':
          description: Transformation successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    description: AI's explanation of the transformation
                  data:
                    type: object
                    additionalProperties: true
                    description: The transformed JSON data
                  debug:
                    type: object
                    description: Debug information about the transformation
              example:
                result: 'Extracted name and email fields from each user'
                data:
                  users:
                    - name: 'John Doe'
                      email: 'john@example.com'
                    - name: 'Jane Smith'
                      email: 'jane@example.com'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    CollectionName:
      name: collection
      in: path
      required: true
      description: MongoDB collection name
      schema:
        type: string
      example: 'users'

    DocumentId:
      name: id
      in: path
      required: true
      description: Document ID (MongoDB ObjectId)
      schema:
        type: string
        pattern: '^[0-9a-fA-F]{24}$'
      example: '507f1f77bcf86cd799439011'

  securitySchemes:
    TenantAuth:
      type: apiKey
      in: header
      name: x-tenant-id
      description: |
        Tenant ID for multi-tenant authentication. Include this header with your tenant ID
        to access tenant-specific data. Most endpoints require this authentication.

  schemas:
    Tenant:
      type: object
      properties:
        id:
          type: string
          description: Tenant ID
        dbName:
          type: string
          description: Database name
        displayConfig:
          type: object
          description: Configuration for field display per collection
          additionalProperties:
            type: array
            items:
              type: string
      example:
        id: '507f1f77bcf86cd799439011'
        dbName: 'my_database'
        displayConfig:
          users: ['name', 'email']
          products: ['name', 'price']

    Pagination:
      type: object
      properties:
        skip:
          type: integer
          description: Number of documents skipped
        limit:
          type: integer
          description: Maximum number of documents returned
        total:
          type: integer
          description: Total number of documents matching the query
        hasMore:
          type: boolean
          description: Whether more documents are available

    Event:
      type: object
      properties:
        _id:
          type: string
          description: Event ID
        type:
          type: string
          enum: [UPDATE, DELETE, QUERY]
          description: Type of event
        collection:
          type: string
          description: Collection name (for UPDATE/DELETE events)
        id:
          type: string
          description: Document ID (for UPDATE/DELETE events)
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        data:
          type: object
          additionalProperties: true
          description: Update data (for UPDATE events)
        queries:
          type: array
          items:
            type: string
          description: Array of query strings (for QUERY events)
        results:
          type: array
          description: Query results summary (for QUERY events)
          items:
            oneOf:
              - type: integer
              - type: object

    PromptLog:
      type: object
      properties:
        _id:
          type: string
          description: Prompt log ID
        prompt:
          type: string
          description: The AI prompt that was executed
        result:
          type: string
          description: The AI's result/response
        queries:
          type: array
          items:
            type: string
          description: Array of MongoDB queries that were executed
        timestamp:
          type: string
          format: date-time
          description: When the prompt was executed
        lastUsedAt:
          type: string
          format: date-time
          description: Last time this prompt was used
        debug:
          type: object
          description: Debug information (only included when debug parameter is true)
          properties:
            messages:
              type: array
              items:
                type: object
                properties:
                  index:
                    type: integer
                  step:
                    type: string
                  content:
                    type: string

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
        details:
          type: string
          description: Additional error details

  responses:
    BadRequest:
      description: Bad request - invalid parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            invalidId:
              summary: Invalid ID format
              value:
                error: 'Invalid ID format'
            invalidPagination:
              summary: Invalid pagination
              value:
                error: 'Invalid skip parameter'
            missingPrompt:
              summary: Missing required field
              value:
                error: 'Prompt is required'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'Document not found'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'Internal server error'
            details: 'Error message details'
