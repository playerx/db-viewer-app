<ion-split-pane contentId="main-content">
  <!-- Menu/Sidebar - Collections List -->
  <ion-menu contentId="main-content">
    <ion-header>
      <ion-toolbar>
        <ion-title>Collections</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <ion-refresher slot="fixed"
                     (ionRefresh)="handleRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

      <ion-searchbar [value]="searchQuery()"
                     (ionInput)="searchQuery.set($any($event.target).value)"
                     placeholder="Search collections"></ion-searchbar>

      @if (loading()) {
      <div class="loadingContainer">
        <ion-spinner></ion-spinner>
      </div>
      } @else if (error()) {
      <div class="emptyState">
        <p>{{ error() }}</p>
        <ion-button (click)="loadCollections()">Retry</ion-button>
      </div>
      } @else if (filteredCollections().length === 0) {
      <div class="emptyState">
        <p>No collections found</p>
      </div>
      } @else {
      <ion-list>
        @for (collection of filteredCollections(); track collection) {
        <ion-item button
                  (click)="selectCollection(collection)"
                  [class.selectedCollection]="selectedCollection() === collection">
          <ion-label>{{ collection }}</ion-label>
          <ion-icon slot="end"
                    name="chevronForward"></ion-icon>
        </ion-item>
        }
      </ion-list>
      }
    </ion-content>
  </ion-menu>

  <!-- Main Content - Documents List -->
  <div class="ion-page"
       id="main-content">
    <ion-header>
      <ion-toolbar>
        <ion-menu-button slot="start"></ion-menu-button>
        <ion-title>
          @if (selectedCollection()) {
          {{ selectedCollection() }}
          } @else {
          Select a Collection
          }
        </ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      @if (selectedCollection()) {
      <ion-refresher slot="fixed"
                     (ionRefresh)="handleDocumentsRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

      <ion-header collapse="condense">
        <ion-toolbar>
          <ion-title size="large">{{ selectedCollection() }}</ion-title>
        </ion-toolbar>
      </ion-header>

      @if (documentsLoading() && documents().length === 0) {
      <div class="loadingContainer">
        <ion-spinner></ion-spinner>
      </div>
      } @else if (documentsError()) {
      <div class="emptyState">
        <p>{{ documentsError() }}</p>
        @if (selectedCollection()) {
        <ion-button (click)="loadDocuments(selectedCollection()!)">Retry</ion-button>
        }
      </div>
      } @else if (documents().length === 0) {
      <div class="emptyState">
        <p>No documents found</p>
      </div>
      } @else {
      <ion-list>
        @for (doc of documents(); track doc._id) {
        @if (doc._id) {
        <ion-item button
                  class="documentItem"
                  (click)="viewDocument(doc._id)">
          <ion-label>
            @if (getDocumentName(doc)) {
            <h2>{{ getDocumentName(doc) }}</h2>
            @if (getDocumentEmail(doc)) {
            <p>{{ getDocumentEmail(doc) }}</p>
            }
            } @else {
            <h2>{{ doc._id }}</h2>
            }
          </ion-label>
          @if (getDocumentUpdateDate(doc)) {
          <ion-note slot="end"
                    class="dateLabel">
            <p>{{ getDocumentUpdateDate(doc) }}</p>
          </ion-note>
          }
          <ion-icon slot="end"
                    name="chevronForward"></ion-icon>
        </ion-item>
        }
        }
      </ion-list>

      @if (pagination()?.hasMore) {
      <ion-infinite-scroll (ionInfinite)="loadMore($event)">
        <ion-infinite-scroll-content></ion-infinite-scroll-content>
      </ion-infinite-scroll>
      }
      }
      } @else {
      <div class="emptyState">
        <p>Select a collection from the left to view its documents</p>
      </div>
      }
    </ion-content>
  </div>
</ion-split-pane>