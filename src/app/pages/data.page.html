<ion-header>
  <ion-toolbar>
    @if (showDocuments()) {
      <ion-button slot="start" fill="clear" (click)="backToCollections()">
        Back
      </ion-button>
    }
    <ion-title>{{ showDocuments() ? selectedCollection() : 'Collections' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">
        {{ showDocuments() ? selectedCollection() : 'Collections' }}
      </ion-title>
    </ion-toolbar>
  </ion-header>

  @if (!showDocuments()) {
    <!-- Collections View -->
    <div class="ion-padding">
      <ion-searchbar
        [value]="searchQuery()"
        (ionInput)="searchQuery.set($any($event.target).value)"
        placeholder="Search collections"
      ></ion-searchbar>

      @if (loading()) {
        <div class="loadingContainer">
          <ion-spinner></ion-spinner>
        </div>
      } @else if (error()) {
        <div class="emptyState">
          <p>{{ error() }}</p>
          <ion-button (click)="loadCollections()">Retry</ion-button>
        </div>
      } @else if (filteredCollections().length === 0) {
        <div class="emptyState">
          <p>No collections found</p>
        </div>
      } @else {
        @for (collection of filteredCollections(); track collection) {
          <ion-card class="collectionCard" (click)="selectCollection(collection)">
            <ion-card-header>
              <ion-card-title>{{ collection }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-icon name="chevronForward"></ion-icon>
            </ion-card-content>
          </ion-card>
        }
      }
    </div>
  } @else {
    <!-- Documents View -->
    <div class="ion-padding">
      @if (loading() && documents().length === 0) {
        <div class="loadingContainer">
          <ion-spinner></ion-spinner>
        </div>
      } @else if (error()) {
        <div class="emptyState">
          <p>{{ error() }}</p>
          <ion-button (click)="loadDocuments(selectedCollection()!)">Retry</ion-button>
        </div>
      } @else if (documents().length === 0) {
        <div class="emptyState">
          <p>No documents found</p>
        </div>
      } @else {
        @if (pagination()) {
          <ion-chip>
            <ion-label>
              Showing {{ documents().length }} of {{ pagination()!.total }} documents
            </ion-label>
          </ion-chip>
        }

        <ion-list>
          @for (doc of documents(); track doc._id) {
            <ion-item class="documentItem" (click)="viewDocument(selectedCollection()!, doc._id!)">
              <ion-label>
                <h2>{{ doc._id }}</h2>
                <p class="documentPreview">{{ getDocumentPreview(doc) }}</p>
              </ion-label>
              <ion-icon slot="end" name="chevronForward"></ion-icon>
            </ion-item>
          }
        </ion-list>

        @if (pagination()?.hasMore) {
          <ion-infinite-scroll (ionInfinite)="loadMore($event)">
            <ion-infinite-scroll-content></ion-infinite-scroll-content>
          </ion-infinite-scroll>
        }
      }
    </div>
  }
</ion-content>